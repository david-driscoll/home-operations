services:
  zigbee2mqtt-poe:
    container_name: zigbee2mqtt-poe
    image: ghcr.io/koenkk/zigbee2mqtt:2.7.1@sha256:163e7351430a95d550d5b1bb958527edc1eff115eb013ca627f3545a192e853f
    restart: unless-stopped
    dns:
      - 100.100.100.100
    labels:
      # Enable Traefik
      traefik.enable: true

      # Zigbee2MQTT - HTTPS
      traefik.http.routers.zigbee-poe.rule: Host(`${APP}.${searchDomain}`) || Host(`${APP}.as.${searchDomain}`) || Host(`zigbee.${searchDomain}`) || Host(`zigbee.as.${searchDomain}`)
      traefik.http.routers.zigbee-poe.entrypoints: websecure
      traefik.http.routers.zigbee-poe.tls.certresolver: le
      traefik.http.routers.zigbee-poe.service: zigbee-poe

      traefik.http.routers.zigbee-poe-tailscale.rule: Host(`zigbee.${tailscaleDomain}`)
      traefik.http.routers.zigbee-poe-tailscale.entrypoints: tailscale
      traefik.http.routers.zigbee-poe-tailscale.service: zigbee-poe

      traefik.http.services.zigbee-poe.loadbalancer.server.port: 8080
    volumes:
      - ./data:/app/data
      - /run/udev:/run/udev:ro
    environment:
      TZ: ${TIMEZONE}
    networks:
      - dockge_default
networks:
  dockge_default:
    external: true
x-dockge:
  urls:
    - https://zigbee.${searchDomain}
    - https://zigbee.as.${searchDomain}
    - https://zigbee.${tailscaleDomain}
